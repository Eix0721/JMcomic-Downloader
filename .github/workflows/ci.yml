name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  verify:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.9", "3.11"]

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r src/requirements.txt
    
    - name: Verify imports
      run: |
        cd src
        python -c "
        try:
            from libs.self.core import main
            print('✅ 核心模块导入成功')
            import jmcomic
            import InquirerPy
            import simpsave
            import yaml
            print('✅ 所有依赖导入成功')
        except Exception as e:
            print(f'❌ 导入失败: {e}')
            import traceback
            traceback.print_exc()
            exit(1)
        "
    
    - name: Check syntax
      run: |
        cd src
        python -m py_compile jmcomic_downloader.py libs/self/*.py
        echo "✅ 语法检查通过"
        
    - name: Simple functionality test
      run: |
        cd src
        # 简单的功能测试 - 只验证程序结构
        python -c "
        print('=== 程序结构测试 ===')
        # 测试是否能导入所有模块
        modules_to_test = [
            'libs.self.core',
            'libs.self.ui',
            'libs.self.config',
            'libs.self.text',
            'libs.self.history',
            'libs.self.test_domain'
        ]

        for module in modules_to_test:
            try:
                __import__(module)
                print(f'✅ {module} 导入成功')
        except Exception as e:
                print(f'❌ {module} 导入失败: {e}')
            exit(1)

        print('=== 所有测试通过 ===')
        "